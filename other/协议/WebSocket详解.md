## 1. 什么是WebSocket?

WebSocket 是 HTML5 开始提供的一种在单个 TCP 连接上进行全双工通讯的协议。

WebSocket 使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。使用WebSocket，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接，并进行双向数据传输。属于服务器推送技术的一种。



## 2. 为什么要使用WebSocket？

因为HTTP协议是**无状态性的**，**被动性的**。

什么是被动性呢，就是服务端不能主动联系客户端，只能由客户端向服务器发起请求。

这种单向请求的特点，注定了如果服务器有连续的状态变化，客户端要获知就非常麻烦。我们只能使用轮询，每隔一段时候，就发出一个询问，了解服务器有没有新的信息。

例如：现在，很多网站为了实现推送技术，所用的技术都是 Ajax 轮询。轮询是在特定的的时间间隔（如每1秒），由浏览器对服务器发出HTTP请求，然后由服务器返回最新的数据给客户端的浏览器。这种传统的模式带来很明显的缺点，即浏览器需要不断的向服务器发出请求，然而HTTP请求可能包含较长的头部，其中真正有效的数据可能只是很小的一部分，显然这样会浪费很多的带宽等资源，并且效率极低。

过程如图：

![1597225995884](C:\Users\zzh\AppData\Roaming\Typora\typora-user-images\1597225995884.png)

> 场景如下：
> 客户端：啦啦啦，有没有新信息(Request)
> 服务端：没有（Response）
> 客户端：啦啦啦，有没有新信息(Request)
> 服务端：没有。。（Response）
> 客户端：啦啦啦，有没有新信息(Request)
> 服务端：你好烦啊，没有啊。。（Response）
> 客户端：啦啦啦，有没有新消息（Request）
> 服务端：好啦好啦，有啦给你。（Response）
> 客户端：啦啦啦，有没有新消息（Request）
> 服务端：。。。。。没。。。。没。。。没有（Response） ---- 不断循环这个过程

因此，工程师们一直在思考，有没有更好的方法。WebSocket 就是这样发明的。

HTML5 定义的 WebSocket 协议，能更好的节省服务器资源和带宽，并且能够更实时地进行通讯。

其他特点包括：

（1）建立在 TCP 协议之上，服务器端的实现比较容易。

（2）与 HTTP 协议有着良好的兼容性。默认端口也是80和443，并且握手阶段采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器。

（3）数据格式比较轻量，性能开销小，通信高效。

（4）可以发送文本，也可以发送二进制数据。

（5）没有同源限制，客户端可以与任意服务器通信。

（6）协议标识符是`ws`（如果加密，则为`wss`），服务器网址就是 URL。

>当采用Websocket之后，服务端就可以主动推送信息给客户端。
>所以上面的情景可以做如下修改。
>客户端：啦啦啦，我要建立Websocket协议，
>服务端：ok，确认
>客户端：麻烦你有信息的时候推送给我噢。。
>服务端：ok，有的时候会告诉你的。
>服务端：balabalabalabala
>服务端：balabalabalabala

就变成了这样，只需要经过一次HTTP请求，就可以做到源源不断的信息传送了。
具体示例参考链接中有比较详细的介绍

[参考链接一](https://www.zhihu.com/question/20215561/answer/40316953)
[参考链接二](http://www.ruanyifeng.com/blog/2017/05/websocket.html)
[参考链接三](https://www.runoob.com/html/html5-websocket.html)

